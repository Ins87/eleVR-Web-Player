function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}!function(t,a){if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var n=a();for(var e in n)("object"==typeof exports?exports:t)[e]=n[e]}}(this,function(){return function(t){function a(e){if(n[e])return n[e].exports;var r=n[e]={exports:{},id:e,loaded:!1};return t[e].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}var n={};return a.m=t,a.c=n,a.p="",a(0)}([function(t,a,n){a.glMatrix=n(1),a.mat2=n(2),a.mat2d=n(3),a.mat3=n(4),a.mat4=n(5),a.quat=n(6),a.vec2=n(9),a.vec3=n(7),a.vec4=n(8)},function(t,a){var n={};n.EPSILON=1e-6,n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.ENABLE_SIMD=!1,n.SIMD_AVAILABLE=n.ARRAY_TYPE===Float32Array&&"SIMD"in this,n.USE_SIMD=n.ENABLE_SIMD&&n.SIMD_AVAILABLE,n.setMatrixArrayType=function(t){n.ARRAY_TYPE=t};var e=Math.PI/180;n.toRadian=function(t){return t*e},n.equals=function(t,a){return Math.abs(t-a)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(a))},t.exports=n},function(t,a,n){var e=n(1),r={};r.create=function(){var t=new e.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},r.clone=function(t){var a=new e.ARRAY_TYPE(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a},r.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},r.fromValues=function(t,a,n,r){var o=new e.ARRAY_TYPE(4);return o[0]=t,o[1]=a,o[2]=n,o[3]=r,o},r.set=function(t,a,n,e,r){return t[0]=a,t[1]=n,t[2]=e,t[3]=r,t},r.transpose=function(t,a){if(t===a){var n=a[1];t[1]=a[2],t[2]=n}else t[0]=a[0],t[1]=a[2],t[2]=a[1],t[3]=a[3];return t},r.invert=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=n*o-r*e;return i?(i=1/i,t[0]=o*i,t[1]=-e*i,t[2]=-r*i,t[3]=n*i,t):null},r.adjoint=function(t,a){var n=a[0];return t[0]=a[3],t[1]=-a[1],t[2]=-a[2],t[3]=n,t},r.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},r.multiply=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=n[0],s=n[1],u=n[2],c=n[3];return t[0]=e*l+o*s,t[1]=r*l+i*s,t[2]=e*u+o*c,t[3]=r*u+i*c,t},r.mul=r.multiply,r.rotate=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=Math.sin(n),s=Math.cos(n);return t[0]=e*s+o*l,t[1]=r*s+i*l,t[2]=e*-l+o*s,t[3]=r*-l+i*s,t},r.scale=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=n[0],s=n[1];return t[0]=e*l,t[1]=r*l,t[2]=o*s,t[3]=i*s,t},r.fromRotation=function(t,a){var n=Math.sin(a),e=Math.cos(a);return t[0]=e,t[1]=n,t[2]=-n,t[3]=e,t},r.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=a[1],t},r.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},r.LDU=function(t,a,n,e){return t[2]=e[2]/e[0],n[0]=e[0],n[1]=e[1],n[3]=e[3]-t[2]*n[1],[t,a,n]},r.add=function(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t},r.subtract=function(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t},r.sub=r.subtract,r.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]},r.equals=function(t,a){var n=t[0],r=t[1],o=t[2],i=t[3],l=a[0],s=a[1],u=a[2],c=a[3];return Math.abs(n-l)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-s)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-u)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-c)<=e.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))},r.multiplyScalar=function(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t},r.multiplyScalarAndAdd=function(t,a,n,e){return t[0]=a[0]+n[0]*e,t[1]=a[1]+n[1]*e,t[2]=a[2]+n[2]*e,t[3]=a[3]+n[3]*e,t},t.exports=r},function(t,a,n){var e=n(1),r={};r.create=function(){var t=new e.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},r.clone=function(t){var a=new e.ARRAY_TYPE(6);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a},r.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},r.fromValues=function(t,a,n,r,o,i){var l=new e.ARRAY_TYPE(6);return l[0]=t,l[1]=a,l[2]=n,l[3]=r,l[4]=o,l[5]=i,l},r.set=function(t,a,n,e,r,o,i){return t[0]=a,t[1]=n,t[2]=e,t[3]=r,t[4]=o,t[5]=i,t},r.invert=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=a[4],l=a[5],s=n*o-e*r;return s?(s=1/s,t[0]=o*s,t[1]=-e*s,t[2]=-r*s,t[3]=n*s,t[4]=(r*l-o*i)*s,t[5]=(e*i-n*l)*s,t):null},r.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},r.multiply=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=n[0],c=n[1],h=n[2],M=n[3],f=n[4],m=n[5];return t[0]=e*u+o*c,t[1]=r*u+i*c,t[2]=e*h+o*M,t[3]=r*h+i*M,t[4]=e*f+o*m+l,t[5]=r*f+i*m+s,t},r.mul=r.multiply,r.rotate=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=Math.sin(n),c=Math.cos(n);return t[0]=e*c+o*u,t[1]=r*c+i*u,t[2]=e*-u+o*c,t[3]=r*-u+i*c,t[4]=l,t[5]=s,t},r.scale=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=n[0],c=n[1];return t[0]=e*u,t[1]=r*u,t[2]=o*c,t[3]=i*c,t[4]=l,t[5]=s,t},r.translate=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=n[0],c=n[1];return t[0]=e,t[1]=r,t[2]=o,t[3]=i,t[4]=e*u+o*c+l,t[5]=r*u+i*c+s,t},r.fromRotation=function(t,a){var n=Math.sin(a),e=Math.cos(a);return t[0]=e,t[1]=n,t[2]=-n,t[3]=e,t[4]=0,t[5]=0,t},r.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=a[1],t[4]=0,t[5]=0,t},r.fromTranslation=function(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=a[0],t[5]=a[1],t},r.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},r.add=function(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t[4]=a[4]+n[4],t[5]=a[5]+n[5],t},r.subtract=function(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t[4]=a[4]-n[4],t[5]=a[5]-n[5],t},r.sub=r.subtract,r.multiplyScalar=function(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*n,t[5]=a[5]*n,t},r.multiplyScalarAndAdd=function(t,a,n,e){return t[0]=a[0]+n[0]*e,t[1]=a[1]+n[1]*e,t[2]=a[2]+n[2]*e,t[3]=a[3]+n[3]*e,t[4]=a[4]+n[4]*e,t[5]=a[5]+n[5]*e,t},r.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]},r.equals=function(t,a){var n=t[0],r=t[1],o=t[2],i=t[3],l=t[4],s=t[5],u=a[0],c=a[1],h=a[2],M=a[3],f=a[4],m=a[5];return Math.abs(n-u)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-c)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(o-h)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(i-M)<=e.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(l-f)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(f))&&Math.abs(s-m)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))},t.exports=r},function(t,a,n){var e=n(1),r={};r.create=function(){var t=new e.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromMat4=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[4],t[4]=a[5],t[5]=a[6],t[6]=a[8],t[7]=a[9],t[8]=a[10],t},r.clone=function(t){var a=new e.ARRAY_TYPE(9);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a},r.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t},r.fromValues=function(t,a,n,r,o,i,l,s,u){var c=new e.ARRAY_TYPE(9);return c[0]=t,c[1]=a,c[2]=n,c[3]=r,c[4]=o,c[5]=i,c[6]=l,c[7]=s,c[8]=u,c},r.set=function(t,a,n,e,r,o,i,l,s,u){return t[0]=a,t[1]=n,t[2]=e,t[3]=r,t[4]=o,t[5]=i,t[6]=l,t[7]=s,t[8]=u,t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.transpose=function(t,a){if(t===a){var n=a[1],e=a[2],r=a[5];t[1]=a[3],t[2]=a[6],t[3]=n,t[5]=a[7],t[6]=e,t[7]=r}else t[0]=a[0],t[1]=a[3],t[2]=a[6],t[3]=a[1],t[4]=a[4],t[5]=a[7],t[6]=a[2],t[7]=a[5],t[8]=a[8];return t},r.invert=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=a[4],l=a[5],s=a[6],u=a[7],c=a[8],h=c*i-l*u,M=-c*o+l*s,f=u*o-i*s,m=n*h+e*M+r*f;return m?(m=1/m,t[0]=h*m,t[1]=(-c*e+r*u)*m,t[2]=(l*e-r*i)*m,t[3]=M*m,t[4]=(c*n-r*s)*m,t[5]=(-l*n+r*o)*m,t[6]=f*m,t[7]=(-u*n+e*s)*m,t[8]=(i*n-e*o)*m,t):null},r.adjoint=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=a[4],l=a[5],s=a[6],u=a[7],c=a[8];return t[0]=i*c-l*u,t[1]=r*u-e*c,t[2]=e*l-r*i,t[3]=l*s-o*c,t[4]=n*c-r*s,t[5]=r*o-n*l,t[6]=o*u-i*s,t[7]=e*s-n*u,t[8]=n*i-e*o,t},r.determinant=function(t){var a=t[0],n=t[1],e=t[2],r=t[3],o=t[4],i=t[5],l=t[6],s=t[7],u=t[8];return a*(u*o-i*s)+n*(-u*r+i*l)+e*(s*r-o*l)},r.multiply=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=a[6],c=a[7],h=a[8],M=n[0],f=n[1],m=n[2],d=n[3],S=n[4],x=n[5],I=n[6],v=n[7],D=n[8];return t[0]=M*e+f*i+m*u,t[1]=M*r+f*l+m*c,t[2]=M*o+f*s+m*h,t[3]=d*e+S*i+x*u,t[4]=d*r+S*l+x*c,t[5]=d*o+S*s+x*h,t[6]=I*e+v*i+D*u,t[7]=I*r+v*l+D*c,t[8]=I*o+v*s+D*h,t},r.mul=r.multiply,r.translate=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=a[6],c=a[7],h=a[8],M=n[0],f=n[1];return t[0]=e,t[1]=r,t[2]=o,t[3]=i,t[4]=l,t[5]=s,t[6]=M*e+f*i+u,t[7]=M*r+f*l+c,t[8]=M*o+f*s+h,t},r.rotate=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=a[6],c=a[7],h=a[8],M=Math.sin(n),f=Math.cos(n);return t[0]=f*e+M*i,t[1]=f*r+M*l,t[2]=f*o+M*s,t[3]=f*i-M*e,t[4]=f*l-M*r,t[5]=f*s-M*o,t[6]=u,t[7]=c,t[8]=h,t},r.scale=function(t,a,n){var e=n[0],r=n[1];return t[0]=e*a[0],t[1]=e*a[1],t[2]=e*a[2],t[3]=r*a[3],t[4]=r*a[4],t[5]=r*a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t},r.fromTranslation=function(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=a[0],t[7]=a[1],t[8]=1,t},r.fromRotation=function(t,a){var n=Math.sin(a),e=Math.cos(a);return t[0]=e,t[1]=n,t[2]=0,t[3]=-n,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=a[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromMat2d=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=0,t[3]=a[2],t[4]=a[3],t[5]=0,t[6]=a[4],t[7]=a[5],t[8]=1,t},r.fromQuat=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=n+n,l=e+e,s=r+r,u=n*i,c=e*i,h=e*l,M=r*i,f=r*l,m=r*s,d=o*i,S=o*l,x=o*s;return t[0]=1-h-m,t[3]=c-x,t[6]=M+S,t[1]=c+x,t[4]=1-u-m,t[7]=f-d,t[2]=M-S,t[5]=f+d,t[8]=1-u-h,t},r.normalFromMat4=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=a[4],l=a[5],s=a[6],u=a[7],c=a[8],h=a[9],M=a[10],f=a[11],m=a[12],d=a[13],S=a[14],x=a[15],I=n*l-e*i,v=n*s-r*i,D=n*u-o*i,F=e*s-r*l,g=e*u-o*l,b=r*u-o*s,p=c*d-h*m,w=c*S-M*m,E=c*x-f*m,y=h*S-M*d,R=h*x-f*d,P=M*x-f*S,z=I*P-v*R+D*y+F*E-g*w+b*p;return z?(z=1/z,t[0]=(l*P-s*R+u*y)*z,t[1]=(s*E-i*P-u*w)*z,t[2]=(i*R-l*E+u*p)*z,t[3]=(r*R-e*P-o*y)*z,t[4]=(n*P-r*E+o*w)*z,t[5]=(e*E-n*R-o*p)*z,t[6]=(d*b-S*g+x*F)*z,t[7]=(S*D-m*b-x*v)*z,t[8]=(m*g-d*D+x*I)*z,t):null},r.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},r.add=function(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t[4]=a[4]+n[4],t[5]=a[5]+n[5],t[6]=a[6]+n[6],t[7]=a[7]+n[7],t[8]=a[8]+n[8],t},r.subtract=function(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t[4]=a[4]-n[4],t[5]=a[5]-n[5],t[6]=a[6]-n[6],t[7]=a[7]-n[7],t[8]=a[8]-n[8],t},r.sub=r.subtract,r.multiplyScalar=function(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*n,t[5]=a[5]*n,t[6]=a[6]*n,t[7]=a[7]*n,t[8]=a[8]*n,t},r.multiplyScalarAndAdd=function(t,a,n,e){return t[0]=a[0]+n[0]*e,t[1]=a[1]+n[1]*e,t[2]=a[2]+n[2]*e,t[3]=a[3]+n[3]*e,t[4]=a[4]+n[4]*e,t[5]=a[5]+n[5]*e,t[6]=a[6]+n[6]*e,t[7]=a[7]+n[7]*e,t[8]=a[8]+n[8]*e,t},r.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]},r.equals=function(t,a){var n=t[0],r=t[1],o=t[2],i=t[3],l=t[4],s=t[5],u=t[6],c=t[7],h=t[8],M=a[0],f=a[1],m=a[2],d=a[3],S=a[4],x=a[5],I=t[6],v=a[7],D=a[8];return Math.abs(n-M)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(r-f)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(o-m)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(i-d)<=e.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(l-S)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(s-x)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(u-I)<=e.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(c-v)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-D)<=e.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))},t.exports=r},function(t,a,n){var e=n(1),r={scalar:{},SIMD:{}};r.create=function(){var t=new e.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.clone=function(t){var a=new e.ARRAY_TYPE(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},r.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},r.fromValues=function(t,a,n,r,o,i,l,s,u,c,h,M,f,m,d,S){var x=new e.ARRAY_TYPE(16);return x[0]=t,x[1]=a,x[2]=n,x[3]=r,x[4]=o,x[5]=i,x[6]=l,x[7]=s,x[8]=u,x[9]=c,x[10]=h,x[11]=M,x[12]=f,x[13]=m,x[14]=d,x[15]=S,x},r.set=function(t,a,n,e,r,o,i,l,s,u,c,h,M,f,m,d,S){return t[0]=a,t[1]=n,t[2]=e,t[3]=r,t[4]=o,t[5]=i,t[6]=l,t[7]=s,t[8]=u,t[9]=c,t[10]=h,t[11]=M,t[12]=f,t[13]=m,t[14]=d,t[15]=S,t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.scalar.transpose=function(t,a){if(t===a){var n=a[1],e=a[2],r=a[3],o=a[6],i=a[7],l=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=n,t[6]=a[9],t[7]=a[13],t[8]=e,t[9]=o,t[11]=a[14],t[12]=r,t[13]=i,t[14]=l}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t},r.SIMD.transpose=function(t,a){var n,e,r,o,i,l,s,u,c,h;return n=SIMD.Float32x4.load(a,0),e=SIMD.Float32x4.load(a,4),r=SIMD.Float32x4.load(a,8),o=SIMD.Float32x4.load(a,12),i=SIMD.Float32x4.shuffle(n,e,0,1,4,5),l=SIMD.Float32x4.shuffle(r,o,0,1,4,5),s=SIMD.Float32x4.shuffle(i,l,0,2,4,6),u=SIMD.Float32x4.shuffle(i,l,1,3,5,7),SIMD.Float32x4.store(t,0,s),SIMD.Float32x4.store(t,4,u),i=SIMD.Float32x4.shuffle(n,e,2,3,6,7),l=SIMD.Float32x4.shuffle(r,o,2,3,6,7),c=SIMD.Float32x4.shuffle(i,l,0,2,4,6),h=SIMD.Float32x4.shuffle(i,l,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,h),t},r.transpose=e.USE_SIMD?r.SIMD.transpose:r.scalar.transpose,r.scalar.invert=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=a[4],l=a[5],s=a[6],u=a[7],c=a[8],h=a[9],M=a[10],f=a[11],m=a[12],d=a[13],S=a[14],x=a[15],I=n*l-e*i,v=n*s-r*i,D=n*u-o*i,F=e*s-r*l,g=e*u-o*l,b=r*u-o*s,p=c*d-h*m,w=c*S-M*m,E=c*x-f*m,y=h*S-M*d,R=h*x-f*d,P=M*x-f*S,z=I*P-v*R+D*y+F*E-g*w+b*p;return z?(z=1/z,t[0]=(l*P-s*R+u*y)*z,t[1]=(r*R-e*P-o*y)*z,t[2]=(d*b-S*g+x*F)*z,t[3]=(M*g-h*b-f*F)*z,t[4]=(s*E-i*P-u*w)*z,t[5]=(n*P-r*E+o*w)*z,t[6]=(S*D-m*b-x*v)*z,t[7]=(c*b-M*D+f*v)*z,t[8]=(i*R-l*E+u*p)*z,t[9]=(e*E-n*R-o*p)*z,t[10]=(m*g-d*D+x*I)*z,t[11]=(h*D-c*g-f*I)*z,t[12]=(l*w-i*y-s*p)*z,t[13]=(n*y-e*w+r*p)*z,t[14]=(d*v-m*F-S*I)*z,t[15]=(c*F-h*v+M*I)*z,t):null},r.SIMD.invert=function(t,a){var n,e,r,o,i,l,s,u,c,h,M=SIMD.Float32x4.load(a,0),f=SIMD.Float32x4.load(a,4),m=SIMD.Float32x4.load(a,8),d=SIMD.Float32x4.load(a,12);return i=SIMD.Float32x4.shuffle(M,f,0,1,4,5),e=SIMD.Float32x4.shuffle(m,d,0,1,4,5),n=SIMD.Float32x4.shuffle(i,e,0,2,4,6),e=SIMD.Float32x4.shuffle(e,i,1,3,5,7),i=SIMD.Float32x4.shuffle(M,f,2,3,6,7),o=SIMD.Float32x4.shuffle(m,d,2,3,6,7),r=SIMD.Float32x4.shuffle(i,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,i,1,3,5,7),i=SIMD.Float32x4.mul(r,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),l=SIMD.Float32x4.mul(e,i),s=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,i),l),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),i=SIMD.Float32x4.mul(e,r),i=SIMD.Float32x4.swizzle(i,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),l),c=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(o,i)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),i=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,2,3,0,1),o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),r=SIMD.Float32x4.swizzle(r,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,i),l),u=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(r,i)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),i=SIMD.Float32x4.mul(n,e),i=SIMD.Float32x4.swizzle(i,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),u),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),c),i=SIMD.Float32x4.swizzle(i,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,i),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(r,i)),i=SIMD.Float32x4.mul(n,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(r,i)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,i),u),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,i),s),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(e,i)),i=SIMD.Float32x4.mul(n,r),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),s),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(e,i)),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,i)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,i),c),h=SIMD.Float32x4.mul(n,l),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,2,3,0,1),h),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,0,3,2),h),i=SIMD.Float32x4.reciprocalApproximation(h),h=SIMD.Float32x4.sub(SIMD.Float32x4.add(i,i),SIMD.Float32x4.mul(h,SIMD.Float32x4.mul(i,i))),(h=SIMD.Float32x4.swizzle(h,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(h,l)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(h,s)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(h,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(h,c)),t):null},r.invert=e.USE_SIMD?r.SIMD.invert:r.scalar.invert,r.scalar.adjoint=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=a[4],l=a[5],s=a[6],u=a[7],c=a[8],h=a[9],M=a[10],f=a[11],m=a[12],d=a[13],S=a[14],x=a[15];return t[0]=l*(M*x-f*S)-h*(s*x-u*S)+d*(s*f-u*M),t[1]=-(e*(M*x-f*S)-h*(r*x-o*S)+d*(r*f-o*M)),t[2]=e*(s*x-u*S)-l*(r*x-o*S)+d*(r*u-o*s),t[3]=-(e*(s*f-u*M)-l*(r*f-o*M)+h*(r*u-o*s)),t[4]=-(i*(M*x-f*S)-c*(s*x-u*S)+m*(s*f-u*M)),t[5]=n*(M*x-f*S)-c*(r*x-o*S)+m*(r*f-o*M),t[6]=-(n*(s*x-u*S)-i*(r*x-o*S)+m*(r*u-o*s)),t[7]=n*(s*f-u*M)-i*(r*f-o*M)+c*(r*u-o*s),t[8]=i*(h*x-f*d)-c*(l*x-u*d)+m*(l*f-u*h),t[9]=-(n*(h*x-f*d)-c*(e*x-o*d)+m*(e*f-o*h)),t[10]=n*(l*x-u*d)-i*(e*x-o*d)+m*(e*u-o*l),t[11]=-(n*(l*f-u*h)-i*(e*f-o*h)+c*(e*u-o*l)),t[12]=-(i*(h*S-M*d)-c*(l*S-s*d)+m*(l*M-s*h)),t[13]=n*(h*S-M*d)-c*(e*S-r*d)+m*(e*M-r*h),t[14]=-(n*(l*S-s*d)-i*(e*S-r*d)+m*(e*s-r*l)),t[15]=n*(l*M-s*h)-i*(e*M-r*h)+c*(e*s-r*l),t},r.SIMD.adjoint=function(t,a){var n,e,r,o,i,l,s,u,c,h,M,f,m,n=SIMD.Float32x4.load(a,0),e=SIMD.Float32x4.load(a,4),r=SIMD.Float32x4.load(a,8),o=SIMD.Float32x4.load(a,12);return c=SIMD.Float32x4.shuffle(n,e,0,1,4,5),l=SIMD.Float32x4.shuffle(r,o,0,1,4,5),i=SIMD.Float32x4.shuffle(c,l,0,2,4,6),l=SIMD.Float32x4.shuffle(l,c,1,3,5,7),c=SIMD.Float32x4.shuffle(n,e,2,3,6,7),u=SIMD.Float32x4.shuffle(r,o,2,3,6,7),s=SIMD.Float32x4.shuffle(c,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,c,1,3,5,7),c=SIMD.Float32x4.mul(s,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.mul(l,c),M=SIMD.Float32x4.mul(i,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,c),h),M=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,c),M),M=SIMD.Float32x4.swizzle(M,2,3,0,1),c=SIMD.Float32x4.mul(l,s),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),h),m=SIMD.Float32x4.mul(i,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(u,c)),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,c),m),m=SIMD.Float32x4.swizzle(m,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,3,0,1),u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),h),f=SIMD.Float32x4.mul(i,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(s,c)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(i,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),f),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),m),c=SIMD.Float32x4.swizzle(c,2,3,0,1),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),f),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.mul(i,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),M=SIMD.Float32x4.sub(M,SIMD.Float32x4.mul(s,c)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),f),c=SIMD.Float32x4.swizzle(c,2,3,0,1),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),M),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(l,c)),c=SIMD.Float32x4.mul(i,s),c=SIMD.Float32x4.swizzle(c,1,0,3,2),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),M),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(l,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),M=SIMD.Float32x4.sub(M,SIMD.Float32x4.mul(u,c)),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),m),SIMD.Float32x4.store(t,0,h),SIMD.Float32x4.store(t,4,M),SIMD.Float32x4.store(t,8,f),SIMD.Float32x4.store(t,12,m),t},r.adjoint=e.USE_SIMD?r.SIMD.adjoint:r.scalar.adjoint,r.determinant=function(t){var a=t[0],n=t[1],e=t[2],r=t[3],o=t[4],i=t[5],l=t[6],s=t[7],u=t[8],c=t[9],h=t[10],M=t[11],f=t[12],m=t[13],d=t[14],S=t[15],x=a*i-n*o,I=a*l-e*o,v=a*s-r*o,D=n*l-e*i,F=n*s-r*i,g=e*s-r*l,b=u*m-c*f,p=u*d-h*f,w=u*S-M*f,E=c*d-h*m,y=c*S-M*m,R=h*S-M*d;return x*R-I*y+v*E+D*w-F*p+g*b},r.SIMD.multiply=function(t,a,n){var e=SIMD.Float32x4.load(a,0),r=SIMD.Float32x4.load(a,4),o=SIMD.Float32x4.load(a,8),i=SIMD.Float32x4.load(a,12),l=SIMD.Float32x4.load(n,0),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),i))));SIMD.Float32x4.store(t,0,s);var u=SIMD.Float32x4.load(n,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),i))));SIMD.Float32x4.store(t,4,c);var h=SIMD.Float32x4.load(n,8),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),i))));SIMD.Float32x4.store(t,8,M);var f=SIMD.Float32x4.load(n,12),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),i))));return SIMD.Float32x4.store(t,12,m),t},r.scalar.multiply=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=a[6],c=a[7],h=a[8],M=a[9],f=a[10],m=a[11],d=a[12],S=a[13],x=a[14],I=a[15],v=n[0],D=n[1],F=n[2],g=n[3];return t[0]=v*e+D*l+F*h+g*d,t[1]=v*r+D*s+F*M+g*S,t[2]=v*o+D*u+F*f+g*x,t[3]=v*i+D*c+F*m+g*I,v=n[4],D=n[5],F=n[6],g=n[7],t[4]=v*e+D*l+F*h+g*d,t[5]=v*r+D*s+F*M+g*S,t[6]=v*o+D*u+F*f+g*x,t[7]=v*i+D*c+F*m+g*I,v=n[8],D=n[9],F=n[10],g=n[11],t[8]=v*e+D*l+F*h+g*d,t[9]=v*r+D*s+F*M+g*S,t[10]=v*o+D*u+F*f+g*x,t[11]=v*i+D*c+F*m+g*I,v=n[12],D=n[13],F=n[14],g=n[15],t[12]=v*e+D*l+F*h+g*d,t[13]=v*r+D*s+F*M+g*S,t[14]=v*o+D*u+F*f+g*x,t[15]=v*i+D*c+F*m+g*I,t},r.multiply=e.USE_SIMD?r.SIMD.multiply:r.scalar.multiply,r.mul=r.multiply,r.scalar.translate=function(t,a,n){var e,r,o,i,l,s,u,c,h,M,f,m,d=n[0],S=n[1],x=n[2];return a===t?(t[12]=a[0]*d+a[4]*S+a[8]*x+a[12],t[13]=a[1]*d+a[5]*S+a[9]*x+a[13],t[14]=a[2]*d+a[6]*S+a[10]*x+a[14],t[15]=a[3]*d+a[7]*S+a[11]*x+a[15]):(e=a[0],r=a[1],o=a[2],i=a[3],l=a[4],s=a[5],u=a[6],c=a[7],h=a[8],M=a[9],f=a[10],m=a[11],t[0]=e,t[1]=r,t[2]=o,t[3]=i,t[4]=l,t[5]=s,t[6]=u,t[7]=c,t[8]=h,t[9]=M,t[10]=f,t[11]=m,t[12]=e*d+l*S+h*x+a[12],t[13]=r*d+s*S+M*x+a[13],t[14]=o*d+u*S+f*x+a[14],t[15]=i*d+c*S+m*x+a[15]),t},r.SIMD.translate=function(t,a,n){var e=SIMD.Float32x4.load(a,0),r=SIMD.Float32x4.load(a,4),o=SIMD.Float32x4.load(a,8),i=SIMD.Float32x4.load(a,12),l=SIMD.Float32x4(n[0],n[1],n[2],0);a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11]),e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(l,0,0,0,0)),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(l,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(l,2,2,2,2));var s=SIMD.Float32x4.add(e,SIMD.Float32x4.add(r,SIMD.Float32x4.add(o,i)));return SIMD.Float32x4.store(t,12,s),t},r.translate=e.USE_SIMD?r.SIMD.translate:r.scalar.translate,r.scalar.scale=function(t,a,n){var e=n[0],r=n[1],o=n[2];return t[0]=a[0]*e,t[1]=a[1]*e,t[2]=a[2]*e,t[3]=a[3]*e,t[4]=a[4]*r,t[5]=a[5]*r,t[6]=a[6]*r,t[7]=a[7]*r,t[8]=a[8]*o,t[9]=a[9]*o,t[10]=a[10]*o,t[11]=a[11]*o,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},r.SIMD.scale=function(t,a,n){var e,r,o,i=SIMD.Float32x4(n[0],n[1],n[2],0);return e=SIMD.Float32x4.load(a,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(i,0,0,0,0))),r=SIMD.Float32x4.load(a,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(i,1,1,1,1))),o=SIMD.Float32x4.load(a,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(i,2,2,2,2))),t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},r.scale=e.USE_SIMD?r.SIMD.scale:r.scalar.scale,r.rotate=function(t,a,n,r){var o,i,l,s,u,c,h,M,f,m,d,S,x,I,v,D,F,g,b,p,w,E,y,R,P=r[0],z=r[1],A=r[2],T=Math.sqrt(P*P+z*z+A*A);return Math.abs(T)<e.EPSILON?null:(T=1/T,P*=T,z*=T,A*=T,o=Math.sin(n),i=Math.cos(n),l=1-i,s=a[0],u=a[1],c=a[2],h=a[3],M=a[4],f=a[5],m=a[6],d=a[7],S=a[8],x=a[9],I=a[10],v=a[11],D=P*P*l+i,F=z*P*l+A*o,g=A*P*l-z*o,b=P*z*l-A*o,p=z*z*l+i,w=A*z*l+P*o,E=P*A*l+z*o,y=z*A*l-P*o,R=A*A*l+i,t[0]=s*D+M*F+S*g,t[1]=u*D+f*F+x*g,t[2]=c*D+m*F+I*g,t[3]=h*D+d*F+v*g,t[4]=s*b+M*p+S*w,t[5]=u*b+f*p+x*w,t[6]=c*b+m*p+I*w,t[7]=h*b+d*p+v*w,t[8]=s*E+M*y+S*R,t[9]=u*E+f*y+x*R,t[10]=c*E+m*y+I*R,t[11]=h*E+d*y+v*R,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},r.scalar.rotateX=function(t,a,n){var e=Math.sin(n),r=Math.cos(n),o=a[4],i=a[5],l=a[6],s=a[7],u=a[8],c=a[9],h=a[10],M=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=o*r+u*e,t[5]=i*r+c*e,t[6]=l*r+h*e,t[7]=s*r+M*e,t[8]=u*r-o*e,t[9]=c*r-i*e,t[10]=h*r-l*e,t[11]=M*r-s*e,t},r.SIMD.rotateX=function(t,a,n){var e=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]);var o=SIMD.Float32x4.load(a,4),i=SIMD.Float32x4.load(a,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(i,e))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,r),SIMD.Float32x4.mul(o,e))),t},r.rotateX=e.USE_SIMD?r.SIMD.rotateX:r.scalar.rotateX,r.scalar.rotateY=function(t,a,n){var e=Math.sin(n),r=Math.cos(n),o=a[0],i=a[1],l=a[2],s=a[3],u=a[8],c=a[9],h=a[10],M=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=o*r-u*e,t[1]=i*r-c*e,t[2]=l*r-h*e,t[3]=s*r-M*e,t[8]=o*e+u*r,t[9]=i*e+c*r,t[10]=l*e+h*r,t[11]=s*e+M*r,t},r.SIMD.rotateY=function(t,a,n){var e=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]);var o=SIMD.Float32x4.load(a,0),i=SIMD.Float32x4.load(a,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(i,e))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,e),SIMD.Float32x4.mul(i,r))),t},r.rotateY=e.USE_SIMD?r.SIMD.rotateY:r.scalar.rotateY,r.scalar.rotateZ=function(t,a,n){var e=Math.sin(n),r=Math.cos(n),o=a[0],i=a[1],l=a[2],s=a[3],u=a[4],c=a[5],h=a[6],M=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=o*r+u*e,t[1]=i*r+c*e,t[2]=l*r+h*e,t[3]=s*r+M*e,t[4]=u*r-o*e,t[5]=c*r-i*e,t[6]=h*r-l*e,t[7]=M*r-s*e,t},r.SIMD.rotateZ=function(t,a,n){var e=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]);var o=SIMD.Float32x4.load(a,0),i=SIMD.Float32x4.load(a,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(i,e))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,r),SIMD.Float32x4.mul(o,e))),t},r.rotateZ=e.USE_SIMD?r.SIMD.rotateZ:r.scalar.rotateZ,r.fromTranslation=function(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},r.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=a[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotation=function(t,a,n){var r,o,i,l=n[0],s=n[1],u=n[2],c=Math.sqrt(l*l+s*s+u*u);return Math.abs(c)<e.EPSILON?null:(c=1/c,l*=c,s*=c,u*=c,r=Math.sin(a),o=Math.cos(a),i=1-o,t[0]=l*l*i+o,t[1]=s*l*i+u*r,t[2]=u*l*i-s*r,t[3]=0,t[4]=l*s*i-u*r,t[5]=s*s*i+o,t[6]=u*s*i+l*r,t[7]=0,t[8]=l*u*i+s*r,t[9]=s*u*i-l*r,t[10]=u*u*i+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},r.fromXRotation=function(t,a){var n=Math.sin(a),e=Math.cos(a);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromYRotation=function(t,a){var n=Math.sin(a),e=Math.cos(a);return t[0]=e,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromZRotation=function(t,a){var n=Math.sin(a),e=Math.cos(a);return t[0]=e,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotationTranslation=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=e+e,s=r+r,u=o+o,c=e*l,h=e*s,M=e*u,f=r*s,m=r*u,d=o*u,S=i*l,x=i*s,I=i*u;return t[0]=1-(f+d),t[1]=h+I,t[2]=M-x,t[3]=0,t[4]=h-I,t[5]=1-(c+d),t[6]=m+S,t[7]=0,t[8]=M+x,t[9]=m-S,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},r.getTranslation=function(t,a){return t[0]=a[12],t[1]=a[13],t[2]=a[14],t},r.getRotation=function(t,a){var n=a[0]+a[5]+a[10],e=0;return n>0?(e=2*Math.sqrt(n+1),t[3]=.25*e,t[0]=(a[6]-a[9])/e,t[1]=(a[8]-a[2])/e,t[2]=(a[1]-a[4])/e):a[0]>a[5]&a[0]>a[10]?(e=2*Math.sqrt(1+a[0]-a[5]-a[10]),t[3]=(a[6]-a[9])/e,t[0]=.25*e,t[1]=(a[1]+a[4])/e,t[2]=(a[8]+a[2])/e):a[5]>a[10]?(e=2*Math.sqrt(1+a[5]-a[0]-a[10]),t[3]=(a[8]-a[2])/e,t[0]=(a[1]+a[4])/e,t[1]=.25*e,
t[2]=(a[6]+a[9])/e):(e=2*Math.sqrt(1+a[10]-a[0]-a[5]),t[3]=(a[1]-a[4])/e,t[0]=(a[8]+a[2])/e,t[1]=(a[6]+a[9])/e,t[2]=.25*e),t},r.fromRotationTranslationScale=function(t,a,n,e){var r=a[0],o=a[1],i=a[2],l=a[3],s=r+r,u=o+o,c=i+i,h=r*s,M=r*u,f=r*c,m=o*u,d=o*c,S=i*c,x=l*s,I=l*u,v=l*c,D=e[0],F=e[1],g=e[2];return t[0]=(1-(m+S))*D,t[1]=(M+v)*D,t[2]=(f-I)*D,t[3]=0,t[4]=(M-v)*F,t[5]=(1-(h+S))*F,t[6]=(d+x)*F,t[7]=0,t[8]=(f+I)*g,t[9]=(d-x)*g,t[10]=(1-(h+m))*g,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},r.fromRotationTranslationScaleOrigin=function(t,a,n,e,r){var o=a[0],i=a[1],l=a[2],s=a[3],u=o+o,c=i+i,h=l+l,M=o*u,f=o*c,m=o*h,d=i*c,S=i*h,x=l*h,I=s*u,v=s*c,D=s*h,F=e[0],g=e[1],b=e[2],p=r[0],w=r[1],E=r[2];return t[0]=(1-(d+x))*F,t[1]=(f+D)*F,t[2]=(m-v)*F,t[3]=0,t[4]=(f-D)*g,t[5]=(1-(M+x))*g,t[6]=(S+I)*g,t[7]=0,t[8]=(m+v)*b,t[9]=(S-I)*b,t[10]=(1-(M+d))*b,t[11]=0,t[12]=n[0]+p-(t[0]*p+t[4]*w+t[8]*E),t[13]=n[1]+w-(t[1]*p+t[5]*w+t[9]*E),t[14]=n[2]+E-(t[2]*p+t[6]*w+t[10]*E),t[15]=1,t},r.fromQuat=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=n+n,l=e+e,s=r+r,u=n*i,c=e*i,h=e*l,M=r*i,f=r*l,m=r*s,d=o*i,S=o*l,x=o*s;return t[0]=1-h-m,t[1]=c+x,t[2]=M-S,t[3]=0,t[4]=c-x,t[5]=1-u-m,t[6]=f+d,t[7]=0,t[8]=M+S,t[9]=f-d,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.frustum=function(t,a,n,e,r,o,i){var l=1/(n-a),s=1/(r-e),u=1/(o-i);return t[0]=2*o*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*s,t[6]=0,t[7]=0,t[8]=(n+a)*l,t[9]=(r+e)*s,t[10]=(i+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o*2*u,t[15]=0,t},r.perspective=function(t,a,n,e,r){var o=1/Math.tan(a/2),i=1/(e-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+e)*i,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*e*i,t[15]=0,t},r.perspectiveFromFieldOfView=function(t,a,n,e){var r=Math.tan(a.upDegrees*Math.PI/180),o=Math.tan(a.downDegrees*Math.PI/180),i=Math.tan(a.leftDegrees*Math.PI/180),l=Math.tan(a.rightDegrees*Math.PI/180),s=2/(i+l),u=2/(r+o);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((i-l)*s*.5),t[9]=(r-o)*u*.5,t[10]=e/(n-e),t[11]=-1,t[12]=0,t[13]=0,t[14]=e*n/(n-e),t[15]=0,t},r.ortho=function(t,a,n,e,r,o,i){var l=1/(a-n),s=1/(e-r),u=1/(o-i);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(a+n)*l,t[13]=(r+e)*s,t[14]=(i+o)*u,t[15]=1,t},r.lookAt=function(t,a,n,o){var i,l,s,u,c,h,M,f,m,d,S=a[0],x=a[1],I=a[2],v=o[0],D=o[1],F=o[2],g=n[0],b=n[1],p=n[2];return Math.abs(S-g)<e.EPSILON&&Math.abs(x-b)<e.EPSILON&&Math.abs(I-p)<e.EPSILON?r.identity(t):(M=S-g,f=x-b,m=I-p,d=1/Math.sqrt(M*M+f*f+m*m),M*=d,f*=d,m*=d,i=D*m-F*f,l=F*M-v*m,s=v*f-D*M,d=Math.sqrt(i*i+l*l+s*s),d?(d=1/d,i*=d,l*=d,s*=d):(i=0,l=0,s=0),u=f*s-m*l,c=m*i-M*s,h=M*l-f*i,d=Math.sqrt(u*u+c*c+h*h),d?(d=1/d,u*=d,c*=d,h*=d):(u=0,c=0,h=0),t[0]=i,t[1]=u,t[2]=M,t[3]=0,t[4]=l,t[5]=c,t[6]=f,t[7]=0,t[8]=s,t[9]=h,t[10]=m,t[11]=0,t[12]=-(i*S+l*x+s*I),t[13]=-(u*S+c*x+h*I),t[14]=-(M*S+f*x+m*I),t[15]=1,t)},r.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},r.add=function(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t[4]=a[4]+n[4],t[5]=a[5]+n[5],t[6]=a[6]+n[6],t[7]=a[7]+n[7],t[8]=a[8]+n[8],t[9]=a[9]+n[9],t[10]=a[10]+n[10],t[11]=a[11]+n[11],t[12]=a[12]+n[12],t[13]=a[13]+n[13],t[14]=a[14]+n[14],t[15]=a[15]+n[15],t},r.subtract=function(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t[4]=a[4]-n[4],t[5]=a[5]-n[5],t[6]=a[6]-n[6],t[7]=a[7]-n[7],t[8]=a[8]-n[8],t[9]=a[9]-n[9],t[10]=a[10]-n[10],t[11]=a[11]-n[11],t[12]=a[12]-n[12],t[13]=a[13]-n[13],t[14]=a[14]-n[14],t[15]=a[15]-n[15],t},r.sub=r.subtract,r.multiplyScalar=function(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*n,t[5]=a[5]*n,t[6]=a[6]*n,t[7]=a[7]*n,t[8]=a[8]*n,t[9]=a[9]*n,t[10]=a[10]*n,t[11]=a[11]*n,t[12]=a[12]*n,t[13]=a[13]*n,t[14]=a[14]*n,t[15]=a[15]*n,t},r.multiplyScalarAndAdd=function(t,a,n,e){return t[0]=a[0]+n[0]*e,t[1]=a[1]+n[1]*e,t[2]=a[2]+n[2]*e,t[3]=a[3]+n[3]*e,t[4]=a[4]+n[4]*e,t[5]=a[5]+n[5]*e,t[6]=a[6]+n[6]*e,t[7]=a[7]+n[7]*e,t[8]=a[8]+n[8]*e,t[9]=a[9]+n[9]*e,t[10]=a[10]+n[10]*e,t[11]=a[11]+n[11]*e,t[12]=a[12]+n[12]*e,t[13]=a[13]+n[13]*e,t[14]=a[14]+n[14]*e,t[15]=a[15]+n[15]*e,t},r.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]&&t[9]===a[9]&&t[10]===a[10]&&t[11]===a[11]&&t[12]===a[12]&&t[13]===a[13]&&t[14]===a[14]&&t[15]===a[15]},r.equals=function(t,a){var n=t[0],r=t[1],o=t[2],i=t[3],l=t[4],s=t[5],u=t[6],c=t[7],h=t[8],M=t[9],f=t[10],m=t[11],d=t[12],S=t[13],x=t[14],I=t[15],v=a[0],D=a[1],F=a[2],g=a[3],b=a[4],p=a[5],w=a[6],E=a[7],y=a[8],R=a[9],P=a[10],z=a[11],A=a[12],T=a[13],L=a[14],_=a[15];return Math.abs(n-v)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-D)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(D))&&Math.abs(o-F)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(F))&&Math.abs(i-g)<=e.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(l-b)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(s-p)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-w)<=e.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-E)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(h-y)<=e.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(M-R)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(R))&&Math.abs(f-P)<=e.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-z)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(d-A)<=e.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(S-T)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(T))&&Math.abs(x-L)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(L))&&Math.abs(I-_)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(_))},t.exports=r},function(t,a,n){var e=n(1),r=n(4),o=n(7),i=n(8),l={};l.create=function(){var t=new e.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},l.rotationTo=function(){var t=o.create(),a=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(e,r,i){var s=o.dot(r,i);return-.999999>s?(o.cross(t,a,r),o.length(t)<1e-6&&o.cross(t,n,r),o.normalize(t,t),l.setAxisAngle(e,t,Math.PI),e):s>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(o.cross(t,r,i),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1+s,l.normalize(e,e))}}(),l.setAxes=function(){var t=r.create();return function(a,n,e,r){return t[0]=e[0],t[3]=e[1],t[6]=e[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],l.normalize(a,l.fromMat3(a,t))}}(),l.clone=i.clone,l.fromValues=i.fromValues,l.copy=i.copy,l.set=i.set,l.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},l.setAxisAngle=function(t,a,n){n=.5*n;var e=Math.sin(n);return t[0]=e*a[0],t[1]=e*a[1],t[2]=e*a[2],t[3]=Math.cos(n),t},l.getAxisAngle=function(t,a){var n=2*Math.acos(a[3]),e=Math.sin(n/2);return 0!=e?(t[0]=a[0]/e,t[1]=a[1]/e,t[2]=a[2]/e):(t[0]=1,t[1]=0,t[2]=0),n},l.add=i.add,l.multiply=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3],l=n[0],s=n[1],u=n[2],c=n[3];return t[0]=e*c+i*l+r*u-o*s,t[1]=r*c+i*s+o*l-e*u,t[2]=o*c+i*u+e*s-r*l,t[3]=i*c-e*l-r*s-o*u,t},l.mul=l.multiply,l.scale=i.scale,l.rotateX=function(t,a,n){n*=.5;var e=a[0],r=a[1],o=a[2],i=a[3],l=Math.sin(n),s=Math.cos(n);return t[0]=e*s+i*l,t[1]=r*s+o*l,t[2]=o*s-r*l,t[3]=i*s-e*l,t},l.rotateY=function(t,a,n){n*=.5;var e=a[0],r=a[1],o=a[2],i=a[3],l=Math.sin(n),s=Math.cos(n);return t[0]=e*s-o*l,t[1]=r*s+i*l,t[2]=o*s+e*l,t[3]=i*s-r*l,t},l.rotateZ=function(t,a,n){n*=.5;var e=a[0],r=a[1],o=a[2],i=a[3],l=Math.sin(n),s=Math.cos(n);return t[0]=e*s+r*l,t[1]=r*s-e*l,t[2]=o*s+i*l,t[3]=i*s-o*l,t},l.calculateW=function(t,a){var n=a[0],e=a[1],r=a[2];return t[0]=n,t[1]=e,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-e*e-r*r)),t},l.dot=i.dot,l.lerp=i.lerp,l.slerp=function(t,a,n,e){var r,o,i,l,s,u=a[0],c=a[1],h=a[2],M=a[3],f=n[0],m=n[1],d=n[2],S=n[3];return o=u*f+c*m+h*d+M*S,0>o&&(o=-o,f=-f,m=-m,d=-d,S=-S),1-o>1e-6?(r=Math.acos(o),i=Math.sin(r),l=Math.sin((1-e)*r)/i,s=Math.sin(e*r)/i):(l=1-e,s=e),t[0]=l*u+s*f,t[1]=l*c+s*m,t[2]=l*h+s*d,t[3]=l*M+s*S,t},l.sqlerp=function(){var t=l.create(),a=l.create();return function(n,e,r,o,i,s){return l.slerp(t,e,i,s),l.slerp(a,r,o,s),l.slerp(n,t,a,2*s*(1-s)),n}}(),l.invert=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=n*n+e*e+r*r+o*o,l=i?1/i:0;return t[0]=-n*l,t[1]=-e*l,t[2]=-r*l,t[3]=o*l,t},l.conjugate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=a[3],t},l.length=i.length,l.len=l.length,l.squaredLength=i.squaredLength,l.sqrLen=l.squaredLength,l.normalize=i.normalize,l.fromMat3=function(t,a){var n,e=a[0]+a[4]+a[8];if(e>0)n=Math.sqrt(e+1),t[3]=.5*n,n=.5/n,t[0]=(a[5]-a[7])*n,t[1]=(a[6]-a[2])*n,t[2]=(a[1]-a[3])*n;else{var r=0;a[4]>a[0]&&(r=1),a[8]>a[3*r+r]&&(r=2);var o=(r+1)%3,i=(r+2)%3;n=Math.sqrt(a[3*r+r]-a[3*o+o]-a[3*i+i]+1),t[r]=.5*n,n=.5/n,t[3]=(a[3*o+i]-a[3*i+o])*n,t[o]=(a[3*o+r]+a[3*r+o])*n,t[i]=(a[3*i+r]+a[3*r+i])*n}return t},l.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},l.exactEquals=i.exactEquals,l.equals=i.equals,t.exports=l},function(t,a,n){var e=n(1),r={};r.create=function(){var t=new e.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},r.clone=function(t){var a=new e.ARRAY_TYPE(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},r.fromValues=function(t,a,n){var r=new e.ARRAY_TYPE(3);return r[0]=t,r[1]=a,r[2]=n,r},r.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},r.set=function(t,a,n,e){return t[0]=a,t[1]=n,t[2]=e,t},r.add=function(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},r.subtract=function(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t},r.sub=r.subtract,r.multiply=function(t,a,n){return t[0]=a[0]*n[0],t[1]=a[1]*n[1],t[2]=a[2]*n[2],t},r.mul=r.multiply,r.divide=function(t,a,n){return t[0]=a[0]/n[0],t[1]=a[1]/n[1],t[2]=a[2]/n[2],t},r.div=r.divide,r.ceil=function(t,a){return t[0]=Math.ceil(a[0]),t[1]=Math.ceil(a[1]),t[2]=Math.ceil(a[2]),t},r.floor=function(t,a){return t[0]=Math.floor(a[0]),t[1]=Math.floor(a[1]),t[2]=Math.floor(a[2]),t},r.min=function(t,a,n){return t[0]=Math.min(a[0],n[0]),t[1]=Math.min(a[1],n[1]),t[2]=Math.min(a[2],n[2]),t},r.max=function(t,a,n){return t[0]=Math.max(a[0],n[0]),t[1]=Math.max(a[1],n[1]),t[2]=Math.max(a[2],n[2]),t},r.round=function(t,a){return t[0]=Math.round(a[0]),t[1]=Math.round(a[1]),t[2]=Math.round(a[2]),t},r.scale=function(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t},r.scaleAndAdd=function(t,a,n,e){return t[0]=a[0]+n[0]*e,t[1]=a[1]+n[1]*e,t[2]=a[2]+n[2]*e,t},r.distance=function(t,a){var n=a[0]-t[0],e=a[1]-t[1],r=a[2]-t[2];return Math.sqrt(n*n+e*e+r*r)},r.dist=r.distance,r.squaredDistance=function(t,a){var n=a[0]-t[0],e=a[1]-t[1],r=a[2]-t[2];return n*n+e*e+r*r},r.sqrDist=r.squaredDistance,r.length=function(t){var a=t[0],n=t[1],e=t[2];return Math.sqrt(a*a+n*n+e*e)},r.len=r.length,r.squaredLength=function(t){var a=t[0],n=t[1],e=t[2];return a*a+n*n+e*e},r.sqrLen=r.squaredLength,r.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t},r.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t[2]=1/a[2],t},r.normalize=function(t,a){var n=a[0],e=a[1],r=a[2],o=n*n+e*e+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=a[0]*o,t[1]=a[1]*o,t[2]=a[2]*o),t},r.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},r.cross=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=n[0],l=n[1],s=n[2];return t[0]=r*s-o*l,t[1]=o*i-e*s,t[2]=e*l-r*i,t},r.lerp=function(t,a,n,e){var r=a[0],o=a[1],i=a[2];return t[0]=r+e*(n[0]-r),t[1]=o+e*(n[1]-o),t[2]=i+e*(n[2]-i),t},r.hermite=function(t,a,n,e,r,o){var i=o*o,l=i*(2*o-3)+1,s=i*(o-2)+o,u=i*(o-1),c=i*(3-2*o);return t[0]=a[0]*l+n[0]*s+e[0]*u+r[0]*c,t[1]=a[1]*l+n[1]*s+e[1]*u+r[1]*c,t[2]=a[2]*l+n[2]*s+e[2]*u+r[2]*c,t},r.bezier=function(t,a,n,e,r,o){var i=1-o,l=i*i,s=o*o,u=l*i,c=3*o*l,h=3*s*i,M=s*o;return t[0]=a[0]*u+n[0]*c+e[0]*h+r[0]*M,t[1]=a[1]*u+n[1]*c+e[1]*h+r[1]*M,t[2]=a[2]*u+n[2]*c+e[2]*h+r[2]*M,t},r.random=function(t,a){a=a||1;var n=2*e.RANDOM()*Math.PI,r=2*e.RANDOM()-1,o=Math.sqrt(1-r*r)*a;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=r*a,t},r.transformMat4=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=n[3]*e+n[7]*r+n[11]*o+n[15];return i=i||1,t[0]=(n[0]*e+n[4]*r+n[8]*o+n[12])/i,t[1]=(n[1]*e+n[5]*r+n[9]*o+n[13])/i,t[2]=(n[2]*e+n[6]*r+n[10]*o+n[14])/i,t},r.transformMat3=function(t,a,n){var e=a[0],r=a[1],o=a[2];return t[0]=e*n[0]+r*n[3]+o*n[6],t[1]=e*n[1]+r*n[4]+o*n[7],t[2]=e*n[2]+r*n[5]+o*n[8],t},r.transformQuat=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=n[0],l=n[1],s=n[2],u=n[3],c=u*e+l*o-s*r,h=u*r+s*e-i*o,M=u*o+i*r-l*e,f=-i*e-l*r-s*o;return t[0]=c*u+f*-i+h*-s-M*-l,t[1]=h*u+f*-l+M*-i-c*-s,t[2]=M*u+f*-s+c*-l-h*-i,t},r.rotateX=function(t,a,n,e){var r=[],o=[];return r[0]=a[0]-n[0],r[1]=a[1]-n[1],r[2]=a[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(e)-r[2]*Math.sin(e),o[2]=r[1]*Math.sin(e)+r[2]*Math.cos(e),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},r.rotateY=function(t,a,n,e){var r=[],o=[];return r[0]=a[0]-n[0],r[1]=a[1]-n[1],r[2]=a[2]-n[2],o[0]=r[2]*Math.sin(e)+r[0]*Math.cos(e),o[1]=r[1],o[2]=r[2]*Math.cos(e)-r[0]*Math.sin(e),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},r.rotateZ=function(t,a,n,e){var r=[],o=[];return r[0]=a[0]-n[0],r[1]=a[1]-n[1],r[2]=a[2]-n[2],o[0]=r[0]*Math.cos(e)-r[1]*Math.sin(e),o[1]=r[0]*Math.sin(e)+r[1]*Math.cos(e),o[2]=r[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},r.forEach=function(){var t=r.create();return function(a,n,e,r,o,i){var l,s;for(n||(n=3),e||(e=0),s=r?Math.min(r*n+e,a.length):a.length,l=e;s>l;l+=n)t[0]=a[l],t[1]=a[l+1],t[2]=a[l+2],o(t,t,i),a[l]=t[0],a[l+1]=t[1],a[l+2]=t[2];return a}}(),r.angle=function(t,a){var n=r.fromValues(t[0],t[1],t[2]),e=r.fromValues(a[0],a[1],a[2]);r.normalize(n,n),r.normalize(e,e);var o=r.dot(n,e);return o>1?0:Math.acos(o)},r.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},r.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]},r.equals=function(t,a){var n=t[0],r=t[1],o=t[2],i=a[0],l=a[1],s=a[2];return Math.abs(n-i)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-l)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-s)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))},t.exports=r},function(t,a,n){var e=n(1),r={};r.create=function(){var t=new e.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},r.clone=function(t){var a=new e.ARRAY_TYPE(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a},r.fromValues=function(t,a,n,r){var o=new e.ARRAY_TYPE(4);return o[0]=t,o[1]=a,o[2]=n,o[3]=r,o},r.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t},r.set=function(t,a,n,e,r){return t[0]=a,t[1]=n,t[2]=e,t[3]=r,t},r.add=function(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t},r.subtract=function(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t},r.sub=r.subtract,r.multiply=function(t,a,n){return t[0]=a[0]*n[0],t[1]=a[1]*n[1],t[2]=a[2]*n[2],t[3]=a[3]*n[3],t},r.mul=r.multiply,r.divide=function(t,a,n){return t[0]=a[0]/n[0],t[1]=a[1]/n[1],t[2]=a[2]/n[2],t[3]=a[3]/n[3],t},r.div=r.divide,r.ceil=function(t,a){return t[0]=Math.ceil(a[0]),t[1]=Math.ceil(a[1]),t[2]=Math.ceil(a[2]),t[3]=Math.ceil(a[3]),t},r.floor=function(t,a){return t[0]=Math.floor(a[0]),t[1]=Math.floor(a[1]),t[2]=Math.floor(a[2]),t[3]=Math.floor(a[3]),t},r.min=function(t,a,n){return t[0]=Math.min(a[0],n[0]),t[1]=Math.min(a[1],n[1]),t[2]=Math.min(a[2],n[2]),t[3]=Math.min(a[3],n[3]),t},r.max=function(t,a,n){return t[0]=Math.max(a[0],n[0]),t[1]=Math.max(a[1],n[1]),t[2]=Math.max(a[2],n[2]),t[3]=Math.max(a[3],n[3]),t},r.round=function(t,a){return t[0]=Math.round(a[0]),t[1]=Math.round(a[1]),t[2]=Math.round(a[2]),t[3]=Math.round(a[3]),t},r.scale=function(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t},r.scaleAndAdd=function(t,a,n,e){return t[0]=a[0]+n[0]*e,t[1]=a[1]+n[1]*e,t[2]=a[2]+n[2]*e,t[3]=a[3]+n[3]*e,t},r.distance=function(t,a){var n=a[0]-t[0],e=a[1]-t[1],r=a[2]-t[2],o=a[3]-t[3];return Math.sqrt(n*n+e*e+r*r+o*o)},r.dist=r.distance,r.squaredDistance=function(t,a){var n=a[0]-t[0],e=a[1]-t[1],r=a[2]-t[2],o=a[3]-t[3];return n*n+e*e+r*r+o*o},r.sqrDist=r.squaredDistance,r.length=function(t){var a=t[0],n=t[1],e=t[2],r=t[3];return Math.sqrt(a*a+n*n+e*e+r*r)},r.len=r.length,r.squaredLength=function(t){var a=t[0],n=t[1],e=t[2],r=t[3];return a*a+n*n+e*e+r*r},r.sqrLen=r.squaredLength,r.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=-a[3],t},r.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t[2]=1/a[2],t[3]=1/a[3],t},r.normalize=function(t,a){var n=a[0],e=a[1],r=a[2],o=a[3],i=n*n+e*e+r*r+o*o;return i>0&&(i=1/Math.sqrt(i),t[0]=n*i,t[1]=e*i,t[2]=r*i,t[3]=o*i),t},r.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},r.lerp=function(t,a,n,e){var r=a[0],o=a[1],i=a[2],l=a[3];return t[0]=r+e*(n[0]-r),t[1]=o+e*(n[1]-o),t[2]=i+e*(n[2]-i),t[3]=l+e*(n[3]-l),t},r.random=function(t,a){return a=a||1,t[0]=e.RANDOM(),t[1]=e.RANDOM(),t[2]=e.RANDOM(),t[3]=e.RANDOM(),r.normalize(t,t),r.scale(t,t,a),t},r.transformMat4=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=a[3];return t[0]=n[0]*e+n[4]*r+n[8]*o+n[12]*i,t[1]=n[1]*e+n[5]*r+n[9]*o+n[13]*i,t[2]=n[2]*e+n[6]*r+n[10]*o+n[14]*i,t[3]=n[3]*e+n[7]*r+n[11]*o+n[15]*i,t},r.transformQuat=function(t,a,n){var e=a[0],r=a[1],o=a[2],i=n[0],l=n[1],s=n[2],u=n[3],c=u*e+l*o-s*r,h=u*r+s*e-i*o,M=u*o+i*r-l*e,f=-i*e-l*r-s*o;return t[0]=c*u+f*-i+h*-s-M*-l,t[1]=h*u+f*-l+M*-i-c*-s,t[2]=M*u+f*-s+c*-l-h*-i,t[3]=a[3],t},r.forEach=function(){var t=r.create();return function(a,n,e,r,o,i){var l,s;for(n||(n=4),e||(e=0),s=r?Math.min(r*n+e,a.length):a.length,l=e;s>l;l+=n)t[0]=a[l],t[1]=a[l+1],t[2]=a[l+2],t[3]=a[l+3],o(t,t,i),a[l]=t[0],a[l+1]=t[1],a[l+2]=t[2],a[l+3]=t[3];return a}}(),r.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]},r.equals=function(t,a){var n=t[0],r=t[1],o=t[2],i=t[3],l=a[0],s=a[1],u=a[2],c=a[3];return Math.abs(n-l)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-s)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-u)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-c)<=e.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))},t.exports=r},function(t,a,n){var e=n(1),r={};r.create=function(){var t=new e.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var a=new e.ARRAY_TYPE(2);return a[0]=t[0],a[1]=t[1],a},r.fromValues=function(t,a){var n=new e.ARRAY_TYPE(2);return n[0]=t,n[1]=a,n},r.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t},r.set=function(t,a,n){return t[0]=a,t[1]=n,t},r.add=function(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t},r.subtract=function(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t},r.sub=r.subtract,r.multiply=function(t,a,n){return t[0]=a[0]*n[0],t[1]=a[1]*n[1],t},r.mul=r.multiply,r.divide=function(t,a,n){return t[0]=a[0]/n[0],t[1]=a[1]/n[1],t},r.div=r.divide,r.ceil=function(t,a){return t[0]=Math.ceil(a[0]),t[1]=Math.ceil(a[1]),t},r.floor=function(t,a){return t[0]=Math.floor(a[0]),t[1]=Math.floor(a[1]),t},r.min=function(t,a,n){return t[0]=Math.min(a[0],n[0]),t[1]=Math.min(a[1],n[1]),t},r.max=function(t,a,n){return t[0]=Math.max(a[0],n[0]),t[1]=Math.max(a[1],n[1]),t},r.round=function(t,a){return t[0]=Math.round(a[0]),t[1]=Math.round(a[1]),t},r.scale=function(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t},r.scaleAndAdd=function(t,a,n,e){return t[0]=a[0]+n[0]*e,t[1]=a[1]+n[1]*e,t},r.distance=function(t,a){var n=a[0]-t[0],e=a[1]-t[1];return Math.sqrt(n*n+e*e)},r.dist=r.distance,r.squaredDistance=function(t,a){var n=a[0]-t[0],e=a[1]-t[1];return n*n+e*e},r.sqrDist=r.squaredDistance,r.length=function(t){var a=t[0],n=t[1];return Math.sqrt(a*a+n*n)},r.len=r.length,r.squaredLength=function(t){var a=t[0],n=t[1];return a*a+n*n},r.sqrLen=r.squaredLength,r.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t},r.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t},r.normalize=function(t,a){var n=a[0],e=a[1],r=n*n+e*e;return r>0&&(r=1/Math.sqrt(r),t[0]=a[0]*r,t[1]=a[1]*r),t},r.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]},r.cross=function(t,a,n){var e=a[0]*n[1]-a[1]*n[0];return t[0]=t[1]=0,t[2]=e,t},r.lerp=function(t,a,n,e){var r=a[0],o=a[1];return t[0]=r+e*(n[0]-r),t[1]=o+e*(n[1]-o),t},r.random=function(t,a){a=a||1;var n=2*e.RANDOM()*Math.PI;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t},r.transformMat2=function(t,a,n){var e=a[0],r=a[1];return t[0]=n[0]*e+n[2]*r,t[1]=n[1]*e+n[3]*r,t},r.transformMat2d=function(t,a,n){var e=a[0],r=a[1];return t[0]=n[0]*e+n[2]*r+n[4],t[1]=n[1]*e+n[3]*r+n[5],t},r.transformMat3=function(t,a,n){var e=a[0],r=a[1];return t[0]=n[0]*e+n[3]*r+n[6],t[1]=n[1]*e+n[4]*r+n[7],t},r.transformMat4=function(t,a,n){var e=a[0],r=a[1];return t[0]=n[0]*e+n[4]*r+n[12],t[1]=n[1]*e+n[5]*r+n[13],t},r.forEach=function(){var t=r.create();return function(a,n,e,r,o,i){var l,s;for(n||(n=2),e||(e=0),s=r?Math.min(r*n+e,a.length):a.length,l=e;s>l;l+=n)t[0]=a[l],t[1]=a[l+1],o(t,t,i),a[l]=t[0],a[l+1]=t[1];return a}}(),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},r.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]},r.equals=function(t,a){var n=t[0],r=t[1],o=a[0],i=a[1];return Math.abs(n-o)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-i)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))},t.exports=r}])}),window.shader=window.shader||{},window.shader.fs="\n  varying mediump vec3 vDirection;\n  uniform mediump float eye;\n  uniform mediump float projection;\n\n  uniform sampler2D uSampler;\n\n  #define PI 3.1415926535897932384626433832795\n\n  mediump vec4 directionToColor(mediump vec3 direction, mediump float eye, mediump float projection) {\n    /*\n    * Input: a direction.  +x = right, +y = up, +z = backward.\n    *        an eye. left = 0, right = 1.\n    *        a projection. see ProjectionEnum in JS file for enum\n    * Output: a color from the video\n    *\n    * Bug alert: the control flow here may screw up texture filtering.\n    */\n\n    mediump float theta = atan(direction.x, -1.0 * direction.z);\n    mediump float phi = atan(direction.y, length(direction.xz));\n\n    /*\n    * The Nexus 7 and the Moto X (and possibly many others) have\n    * a buggy atan2 implementation that screws up when the numerator\n    * (the first argument) is too close to zero.  (The 1e-4 is carefully\n    * chosen: 1e-5 doesn't fix the problem.\n    */\n    if (abs(direction.x) < 1e-4 * abs(direction.z))\n    theta = 0.5*PI * (1.0 - sign(-1.0 * direction.z));\n    if (abs(direction.y) < 1e-4 * length(direction.xz))\n    phi = 0.0;\n\n    // Uncomment to debug the transformations.\n    // return vec4(theta / (2. * PI) + 0.5, phi / (2. * PI) + 0.5, 0., 0.);\n\n    if (projection == 0.) {\n      // Projection == 0: equirectangular projection\n      return texture2D(uSampler, vec2(mod(theta / (2.0*PI), 1.0), phi / PI + 0.5));\n    } else {\n      // Projection == 1: equirectangular top/bottom 3D projection\n      eye = 1. - eye;\n      return texture2D(uSampler, vec2(mod(theta / (2.0*PI), 1.0), ((phi / PI + 0.5) + eye)/ 2.));\n    }\n  }\n\n  void main(void) {\n    gl_FragColor = directionToColor(vDirection, eye, projection);\n  }\n",window.shader=window.shader||{},window.shader.vs="\n  attribute mediump vec2 aVertexPosition;\n\n  uniform mediump mat4 proj_inv;\n\n  varying mediump vec3 vDirection;\n\n  void main(void) {\n    gl_Position = vec4(aVertexPosition, 1.0, 1.0);\n    mediump vec4 projective_direction = proj_inv * gl_Position;\n    vDirection = projective_direction.xyz / projective_direction.w;\n  }\n",function(t){"use strict";var a={getScreenOrientation:function(){switch(window.screen.orientation||window.screen.mozOrientation){case"landscape-primary":return 90;case"landscape-secondary":return-90;case"portrait-secondary":return 180;case"portrait-primary":return 0}if(void 0!==window.orientation)return window.orientation},mat4PerspectiveFromVRFieldOfView:function(t,a,n){var e=Math.tan(t.upDegrees*Math.PI/180),r=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),i=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+i),s=2/(e+r),u=new Float32Array(16);return u[0]=l,u[4]=0,u[8]=-((o-i)*l*.5),u[12]=0,u[1]=0,u[5]=s,u[9]=(e-r)*s*.5,u[13]=0,u[2]=0,u[6]=0,u[10]=n/(a-n),u[14]=n*a/(a-n),u[3]=0,u[7]=0,u[11]=-1,u[15]=0,u},isFullscreen:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.webkitCurrentFullScreenElement},setCanvasSize:function(t,n){var e,r,o=webVR.getInstance().vrHMD;if(e=window.innerWidth,r=window.innerHeight,o&&"undefined"!=typeof a.isFullscreen()&&a.isFullscreen()){var i=o.getEyeParameters("right").renderRect;t.width=2*i.width,t.height=i.height}else{var l=window.devicePixelRatio||1,s=l/n;t.width===e*s&&t.height===r*s||(t.width=e*s,t.height=r*s)}t.style.width="100%",t.style.height="100%"},getExtension:function(t){return t.substr(t.lastIndexOf(".")+1)},getBaseFilename:function(t){return t.substr(t.lastIndexOf("/")+1)},hasVideoExtension:function(t){var n=a.getExtension(t);return"mp4"===n||"ogg"===n||"webm"===n},getVideoTitle:function(t){return a.hasVideoExtension(t)?a.getBaseFilename(t):t}};t.util=a}(window);var _createClass=function(){function t(t,a){for(var n=0;n<a.length;n++){var e=a[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(a,n,e){return n&&t(a.prototype,n),e&&t(a,e),a}}();!function(t){"use strict";var a=function(){function t(){var a=this;_classCallCheck(this,t),this.deviceAlpha=null,this.deviceGamma=null,this.deviceBeta=null,window.addEventListener("deviceorientation",function(t){a.deviceAlpha=t.alpha,a.deviceGamma=t.gamma,a.deviceBeta=t.beta})}return _createClass(t,[{key:"orientationIsAvailable",value:function(){return null!==this.deviceAlpha}},{key:"rotationQuat",value:function(){if(!this.orientationIsAvailable())return quat.create(1,0,0,0);var t=Math.PI/180,a=this.deviceAlpha*t/2,n=this.deviceBeta*t/2,e=this.deviceGamma*t/2,r=Math.cos(n),o=Math.cos(e),i=Math.cos(a),l=Math.sin(n),s=Math.sin(e),u=Math.sin(a),c=r*o*i-l*s*u;n=l*o*i-r*s*u,e=r*s*i+l*o*u,a=r*o*u+l*s*i;var h=quat.fromValues(n,e,a,c),M=util.getScreenOrientation()*t/2,f=[0,0,-Math.sin(M),Math.cos(M)],m=quat.create();quat.multiply(m,h,f);var d=Math.sqrt(.5);return quat.multiply(m,quat.fromValues(-d,0,0,d),m),m}}]),t}();t.PhoneVR=function(){var t=void 0;return{getInstance:function(){return t||(t=new a),t}}}()}(window);var _createClass=function(){function t(t,a){for(var n=0;n<a.length;n++){var e=a[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(a,n,e){return n&&t(a.prototype,n),e&&t(a,e),a}}(),PlayerControls=function(){function t(a,n){function e(){var t=quat.create(),a=new Float32Array([0,0,0]);return a[0]=180*Math.asin(2*(t[0]*t[2]-t[1]*t[3]))/Math.PI,a[1]=180*Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))/Math.PI,a}_classCallCheck(this,t),this.video=a,this.canvas=n,this.manualRotateRate=new Float32Array([0,0,0]),this.latlong=e(),this.manualRotation=quat.create(),this.manualControls={a:{index:1,sign:1,active:0},d:{index:1,sign:-1,active:0},w:{index:0,sign:1,active:0},s:{index:0,sign:-1,active:0}},this.initKeys()}return _createClass(t,[{key:"initKeys",value:function(){function t(t){e.canvas.addEventListener("mousemove",n),r=t.clientX,o=t.clientY}function a(t){e.canvas.removeEventListener("mousemove",n),e.manualRotateRate[0]=0,e.manualRotateRate[1]=0,e.manualRotateRate[2]=0}function n(t){var a=t.clientX-r,n=t.clientY-o,i=e.canvas.width,l=e.canvas.height,s=Math.min(i,l);e.manualRotateRate[0]+=2*-n/s,e.manualRotateRate[1]+=2*-a/s,r=t.clientX,o=t.clientY}var e=this,r=void 0,o=void 0;this.onKeyPress=this.onKeyPress.bind(this),document.addEventListener("keydown",this.onKeyPress),document.addEventListener("keyup",this.onKeyPress),e.canvas.addEventListener("mousedown",t),e.canvas.addEventListener("mouseup",a)}},{key:"onKeyPress",value:function(t){function a(){"keydown"!==t.type&&(webVR.getInstance().vrSensor?webVR.getInstance().vrSensor.zeroSensor():quat.invert(e.manualRotation,PhoneVR.getInstance().rotationQuat()))}function n(t,a){var n=e.manualControls[String.fromCharCode(t.keyCode).toLowerCase()];n&&(1===a&&n.active||a===-1&&!n.active||(n.active=1===a,e.manualRotateRate[n.index]+=a*n.sign))}var e=this;switch(String.fromCharCode(t.charCode)){case"z":a();break;default:n(t,"keydown"===t.type?1:-1)}}},{key:"destroy",value:function(){document.removeEventListener("keydown",this.onKeyPress),document.removeEventListener("keyup",this.onKeyPress),this.canvas.removeEventListener("mousedown"),this.canvas.removeEventListener("mouseup"),this.canvas.removeEventListener("mousemove"),this.video=null,this.canvas=null}}]),t}(),_createClass=function(){function t(t,a){for(var n=0;n<a.length;n++){var e=a[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(a,n,e){return n&&t(a.prototype,n),e&&t(a,e),a}}(),PlayerWebGL=function(){function t(a,n){function e(){return i.canvas.getContext("webgl")||i.canvas.getContext("experimental-webgl")}function r(){i.gl.clearColor(0,0,0,0),i.gl.clearDepth(1),i.gl.disable(i.gl.DEPTH_TEST),o()}function o(){var t={fragmentShaderName:"fs",vertexShaderName:"vs",attributes:["aVertexPosition"],uniforms:["uSampler","eye","projection","proj_inv"]};i.program=i.gl.createProgram(),i.gl.attachShader(i.program,i.getShaderByName(t.vertexShaderName,"x-vertex")),i.gl.attachShader(i.program,i.getShaderByName(t.fragmentShaderName,"x-fragment")),i.gl.linkProgram(i.program),i.gl.getProgramParameter(i.program,i.gl.LINK_STATUS)||alert("Unable to initialize the shader program: "+i.gl.getProgramInfoLog(i.program)),i.gl.useProgram(i.program),i.attributes={};for(var a=0;a<t.attributes.length;a++){var n=t.attributes[a];i.attributes[n]=i.gl.getAttribLocation(i.program,n),i.gl.enableVertexAttribArray(i.attributes[n])}i.uniforms={};for(var e=0;e<t.uniforms.length;e++){var r=t.uniforms[e];i.uniforms[r]=i.gl.getUniformLocation(i.program,r),i.gl.enableVertexAttribArray(i.attributes[r])}}_classCallCheck(this,t);var i=this;this.eyeCount=1,this.video=a,this.canvas=n,this.gl=null,this.positionsBuffer=null,this.projection=0,this.controls=null,this.texture=null,this.verticesIndexBuffer=null,this.timing={showTiming:!1,frameTime:0,prevFrameTime:0,canvasResized:0,textureLoaded:0,start:0,end:0,framesSinceIssue:0};try{this.gl=e()}catch(l){}return this.gl?void r():void alert("Unable to initialize WebGL. Your browser may not support it.")}return _createClass(t,[{key:"drawScene",value:function(t){if(this.timing.frameTime=t,this.timing.showTiming&&(this.timing.start=performance.now()),util.setCanvasSize(this.canvas,this.getBackingStorePixelRatio()),this.timing.showTiming&&(this.timing.canvasResized=performance.now()),this.updateTexture(),this.timing.showTiming&&(this.timing.textureLoaded=performance.now()),this.timing.prevFrameTime){var a=.001*(this.timing.frameTime-this.timing.prevFrameTime);this.controls.latlong[0]+=this.controls.manualRotateRate[0]*a*90,this.controls.latlong[1]+=this.controls.manualRotateRate[1]*a*90;var n=Math.PI/180/2,e=quat.fromValues(Math.cos(n*this.controls.latlong[1]),0,-Math.sin(n*this.controls.latlong[1]),0),r=quat.fromValues(Math.cos(n*this.controls.latlong[0]),0,0,-Math.sin(n*this.controls.latlong[0]));quat.multiply(this.controls.manualRotation,e,r)}var o=mat4.create(),i=webVR.getInstance().vrHMD;if(i){var l=i.getEyeParameters("left"),s=i.getEyeParameters("right");o=util.mat4PerspectiveFromVRFieldOfView(l.recommendedFieldOfView,.1,10),this.drawEye("left",o),o=util.mat4PerspectiveFromVRFieldOfView(s.recommendedFieldOfView,.1,10),this.drawEye("right",o)}else{var u=void 0;2===this.eyeCount?(u=this.canvas.width/2/this.canvas.height,
mat4.perspective(o,Math.PI/2,u,.1,10),this.drawEye("left",o),this.drawEye("right",o)):(u=this.canvas.width/this.canvas.height,mat4.perspective(o,Math.PI/2,u,.1,10),this.drawEye("both",o))}this.timing.showTiming&&(this.gl.finish(),this.timing.end=performance.now(),this.timing.end-this.timing.frameTime>20?(console.log(this.timing.framesSinceIssue+" Frame time: "+(this.timing.start-this.timing.frameTime)+"ms animation frame lag + "+(this.timing.canvasResized-this.timing.start)+"ms canvas resized + "+(this.timing.textureLoaded-this.timing.canvasResized)+"ms to load texture + "+(this.timing.end-this.timing.textureLoaded)+"ms = "+(this.timing.end-this.timing.frameTime)+"ms"),this.timing.framesSinceIssue=0):this.timing.framesSinceIssue++),this.play(),this.timing.prevFrameTime=this.timing.frameTime}},{key:"drawEye",value:function(t,a){function n(){var t=quat.create(),a=quat.create();if(webVR.getInstance().vrSensor){var n=webVR.getInstance().vrSensor.getState();null!==n&&null!==n.orientation&&"undefined"!=typeof n.orientation&&0!==n.orientation.x&&0!==n.orientation.y&&0!==n.orientation.z&&0!==n.orientation.w&&(a=new Float32Array([n.orientation.x,n.orientation.y,n.orientation.z,n.orientation.w]))}else a=PhoneVR.getInstance().rotationQuat();return quat.multiply(t,e.controls.manualRotation,a),t}var e=this;this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionsBuffer),this.gl.vertexAttribPointer(this.attributes.aVertexPosition,2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.uniform1i(this.uniforms.uSampler,0),this.gl.uniform1f(this.uniforms.eye,"right"===t?1:0),this.gl.uniform1f(this.uniforms.projection,this.projection);var r=mat4.create(),o=n();mat4.fromQuat(r,o);var i=mat4.create();mat4.invert(i,a);var l=mat4.create();mat4.multiply(l,r,i),this.gl.uniformMatrix4fv(this.uniforms.proj_inv,!1,l),"left"===t&&this.gl.viewport(0,0,this.canvas.width/2,this.canvas.height),"right"===t&&this.gl.viewport(this.canvas.width/2,0,this.canvas.width/2,this.canvas.height),"both"===t&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.verticesIndexBuffer),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}},{key:"play",value:function(){var t=this;this.reqAnimFrameID=requestAnimationFrame(function(a){t.drawScene(a)})}},{key:"stop",value:function(){cancelAnimationFrame(this.reqAnimFrameID)}},{key:"getBackingStorePixelRatio",value:function(){return this.gl.webkitBackingStorePixelRatio||this.gl.mozBackingStorePixelRatio||this.gl.msBackingStorePixelRatio||this.gl.oBackingStorePixelRatio||this.gl.backingStorePixelRatio||1}},{key:"initBuffers",value:function(){this.positionsBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionsBuffer);var t=[-1,-1,1,-1,1,1,-1,1];this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.verticesIndexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.verticesIndexBuffer);var a=[0,1,2,0,2,3];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),this.gl.STATIC_DRAW)}},{key:"initTextures",value:function(){this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}},{key:"updateTexture",value:function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGB,this.gl.RGB,this.gl.UNSIGNED_BYTE,this.video),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}},{key:"setProjection",value:function(t){function a(t){switch(t.toLowerCase()){case"mono":case"2d":case"0":case"equirectangular":return 0;default:return 1}}this.projection=a(t)}},{key:"setControls",value:function(t){this.controls=t}},{key:"setEyeCount",value:function(t){this.eyeCount=t}},{key:"getShaderByName",value:function(t,a){var n="";if(!window.shader||!window.shader[t])return null;var e=window.shader[t];if("x-fragment"===a)n=this.gl.createShader(this.gl.FRAGMENT_SHADER);else{if("x-vertex"!==a)return null;n=this.gl.createShader(this.gl.VERTEX_SHADER)}return this.gl.shaderSource(n,e),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(alert("An error occurred compiling the shaders: "+this.gl.getShaderInfoLog(n)),null)}},{key:"destroy",value:function(){this.stop(),this.video=null,this.canvas=null,this.controls=null}}]),t}();!function(t){"use strict";var a=function n(){_classCallCheck(this,n);this.vrHMD=null,this.vrSensor=null,navigator.getVRDevices&&navigator.getVRDevices().then(webVR.vrDeviceCallback)};t.webVR=function(){var t=void 0;return{getInstance:function(){return t||(t=new a),t}}}()}(window);var _createClass=function(){function t(t,a){for(var n=0;n<a.length;n++){var e=a[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(a,n,e){return n&&t(a.prototype,n),e&&t(a,e),a}}(),EleVRPlayer=function(){function t(a){var n=this;_classCallCheck(this,t),this.video=a,this.canvas=document.createElement("canvas"),this.canvas.classList=this.video.classList,this.canvas.classList.add("elevr"),this.video.style.display="none",this.video.parentNode.insertBefore(this.canvas,this.video),this.webGL=new PlayerWebGL(this.video,this.canvas),this.webGL.gl&&(util.setCanvasSize(this.canvas,this.webGL.getBackingStorePixelRatio()),this.controls=new PlayerControls(this.video,this.canvas),this.webGL.setControls(this.controls),this.webGL.initBuffers(),this.webGL.initTextures(),this.webGL.play(),this.setEyeCount=function(t){return n.webGL.setEyeCount(t)})}return _createClass(t,[{key:"destroy",value:function(){this.webGL.destroy(),this.controls.destroy(),this.video.parentNode.removeChild(this.canvas),this.canvas=null,this.video.style.display="",this.video=null}}]),t}();window.EleVRPlayer=EleVRPlayer;
//# sourceMappingURL=player.min.js.map
